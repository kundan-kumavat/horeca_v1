generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ─── ENUMS ───────────────────────────────────────────────
//

enum UserRole {
  MASTER_ADMIN
  BRANCH_ADMIN
}

enum TableStatus {
  AVAILABLE
  OCCUPIED
  RESERVED
}

enum OrderStatus {
  REQUESTED
  ACCEPTED
  READY
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  PAY_AT_COUNTER
  REFUNDED
}

//
// ─── MODELS ──────────────────────────────────────────────
//

model Hotel {
  id            String   @id @default(uuid())
  name          String
  address       String?
  contactEmail  String?
  contactPhone  String?
  masterAdminId String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  masterAdmin User?    @relation("MasterAdmin", fields: [masterAdminId], references: [id])
  branches    Branch[]
}

model Branch {
  id                String   @id @default(uuid())
  name              String
  address           String?
  currency          String   @default("INR")
  timezone          String?
  defaultTaxPercent Float    @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  hotelId    String
  hotel      Hotel      @relation(fields: [hotelId], references: [id])
  adminId    String?    @unique
  admin      User?      @relation("BranchAdmin", fields: [adminId], references: [id])
  tables     Table[]
  categories Category[]
  menuItems  MenuItem[]
  orders     Order[]
  qrcodes    QRCode[]
  users      User[]     @relation("BranchUsers")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(MASTER_ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  hotel        Hotel?  @relation("MasterAdmin")
  branch       Branch? @relation("BranchAdmin")
  branchUser   Branch? @relation("BranchUsers", fields: [branchUserId], references: [id])
  branchUserId String?
}

model Table {
  id       String      @id @default(uuid())
  branchId String
  branch   Branch      @relation(fields: [branchId], references: [id])
  number   String
  capacity Int?
  status   TableStatus @default(AVAILABLE)

  // Relations
  qrcodes QRCode[]
  orders  Order[]
}

model QRCode {
  id        String   @id @default(uuid())
  branchId  String
  branch    Branch   @relation(fields: [branchId], references: [id])
  tableId   String?
  table     Table?   @relation(fields: [tableId], references: [id])
  label     String?
  shortPath String?
  url       String
  createdAt DateTime @default(now())
}

model Category {
  id          String     @id @default(uuid())
  branchId    String
  branch      Branch     @relation(fields: [branchId], references: [id])
  name        String
  description String?
  isActive    Boolean    @default(true)
  order       Int        @default(0)
  menuItems   MenuItem[]
}

model MenuItem {
  id          String    @id @default(uuid())
  branchId    String
  branch      Branch    @relation(fields: [branchId], references: [id])
  categoryId  String?
  category    Category? @relation(fields: [categoryId], references: [id])
  name        String
  description String?
  price       Float
  images      String[]  @default([])
  labels      String[]  @default([])
  prepTime    Int?
  isAvailable Boolean   @default(true)
}

model Order {
  id            String        @id @default(uuid())
  branchId      String
  branch        Branch        @relation(fields: [branchId], references: [id])
  tableId       String?
  table         Table?        @relation(fields: [tableId], references: [id])
  clientName    String?
  clientPhone   String?
  items         Json
  totalAmount   Float
  taxAmount     Float
  finalAmount   Float
  paymentMethod String
  paymentStatus PaymentStatus @default(PENDING)
  status        OrderStatus   @default(REQUESTED)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}
